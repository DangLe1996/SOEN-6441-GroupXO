


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: GetTweets</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">models</a> ]
</div>

<h1>Coverage Summary for Class: GetTweets (models)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GetTweets</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (22/ 22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.6%
  </span>
  <span class="absValue">
    (109/ 114)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GetTweets$$FastClassByGuice$$5ab0c74</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$2AmVHrZF</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$3gOF2tjS</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$41GMHGY8</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$7DkeEDvd</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$biKxWzLr</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$Ed9htr5D</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$EDwyb6hi</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$g8ZjECrK</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$gRpM2LSa</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$hAo50AdW</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$jq4WtchY</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$jtkPcJsj</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$kCFdJLOq</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$MbbW7wdL</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$nsw35yWe</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$q1urui9B</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$qRiwbVdJ</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$rBdvoSLV</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$sAPCSKbZ</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$SDSHckFC</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$SiCu4X4T</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$ssqQIUsR</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$weMXiykC</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$xmzlh2IQ</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$Y5DXE2iH</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$YJU5wOzj</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$ZiEJwsOx</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$zlC9l9ys</td>
  </tr>
  <tr>
    <td class="name">GetTweets$MockitoMock$304996963$auxiliary$ZUK2DYjs</td>
  </tr>
  <tr>
    <td class="name">GetTweets$Mode</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/ 2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/ 2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (24/ 24)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.7%
  </span>
  <span class="absValue">
    (111/ 116)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;package models;
<i>2</i>&nbsp;
<i>3</i>&nbsp;
<i>4</i>&nbsp;import java.util.Map;
<i>5</i>&nbsp;import java.util.HashMap;
<i>6</i>&nbsp;import java.util.Arrays;
<i>7</i>&nbsp;import java.util.List;
<i>8</i>&nbsp;import java.util.concurrent.CompletableFuture;
<i>9</i>&nbsp;import java.util.concurrent.CompletionStage;
<i>10</i>&nbsp;import java.util.function.BiFunction;
<i>11</i>&nbsp;import java.util.function.Function;
<i>12</i>&nbsp;import java.util.stream.Collectors;
<i>13</i>&nbsp;import static java.util.stream.Collectors.groupingBy;
<i>14</i>&nbsp;
<i>15</i>&nbsp;import com.google.inject.AbstractModule;
<i>16</i>&nbsp;import com.typesafe.config.ConfigException;
<i>17</i>&nbsp;import twitter4j.*;
<i>18</i>&nbsp;
<i>19</i>&nbsp;import javax.security.sasl.AuthenticationException;
<i>20</i>&nbsp;
<i>21</i>&nbsp;/**
<i>22</i>&nbsp; * Handles the request of getting TwitterAPI
<i>23</i>&nbsp; */
<i>24</i>&nbsp;public class GetTweets extends AbstractModule {
<i>25</i>&nbsp;
<i>26</i>&nbsp;
<i>27</i>&nbsp;
<i>28</i>&nbsp;
<i>29</i>&nbsp;    private Twitter twitter ;
<b class="fc"><i>30</i>&nbsp;    public GetTweets(Twitter inputTwitter){</b>
<b class="fc"><i>31</i>&nbsp;        twitter = inputTwitter;</b>
<b class="fc"><i>32</i>&nbsp;    };</b>
<b class="fc"><i>33</i>&nbsp;    public GetTweets(){</b>
<b class="fc"><i>34</i>&nbsp;        twitter = new TwitterFactory().getInstance();</b>
<b class="fc"><i>35</i>&nbsp;    }</b>
<i>36</i>&nbsp;
<i>37</i>&nbsp;
<i>38</i>&nbsp;    /**
<i>39</i>&nbsp;     * Store results of all searched queries in a formatted HTML string, using searched keyword as key.
<i>40</i>&nbsp;     * This GlobalCache reduce the needs to connect to Twitter4J if the
<i>41</i>&nbsp;     * term was already searched.
<i>42</i>&nbsp;     */
<b class="fc"><i>43</i>&nbsp;    public static HashMap&lt;String, String&gt; GlobalCache = new HashMap&lt;&gt;();</b>
<b class="fc"><i>44</i>&nbsp;    public static HashMap&lt;String, String&gt; GlobalSentiments = new HashMap&lt;&gt;(); //suhel</b>
<b class="fc"><i>45</i>&nbsp;    public static HashMap&lt;String, List&lt;String&gt;&gt; GlobalWordStatsCache = new HashMap&lt;&gt;();</b>
<i>46</i>&nbsp;
<i>47</i>&nbsp;
<i>48</i>&nbsp;    /**
<i>49</i>&nbsp;     * User Defined array of words which when present marks a tweet as happy
<i>50</i>&nbsp;     */
<b class="fc"><i>51</i>&nbsp;    private final static String[] happy = {&quot;HAPPY&quot;, &quot;:)&quot;, &quot;:D&quot;, &quot;&lt;3&quot;, &quot;PARTY&quot;, &quot;?&quot;,&quot;?&quot;, &quot;?&quot;,&quot;\uD83D\uDC97\uD83D\uDC93&quot;,&quot;APPRECIATE&quot;,&quot;\uD83D\uDC9A&quot;,&quot;\uD83D\uDC4F&quot;,&quot;\uD83E\uDDE1&quot;,&quot;\uD83D\uDC9B&quot;,&quot;\uD83D\uDC9A&quot;,&quot;\uD83D\uDC9C&quot;,&quot;\uD83E\uDD70&quot;,&quot;\uD83D\uDDA4&quot;};</b>
<i>52</i>&nbsp;    /**
<i>53</i>&nbsp;     * User Defined array of words which when present marks a tweet as sad
<i>54</i>&nbsp;     */
<b class="fc"><i>55</i>&nbsp;    private final static String[] sad = {&quot;SAD&quot;, &quot;ANGRY&quot;, &quot;:(&quot;, &quot;MAD&quot;, &quot;DISAPPOINTMENT&quot;, &quot;BAD DAY&quot;,&quot;\uD83D\uDCCA&quot;,&quot;\uD83D\uDE1E&quot;,&quot;\uD83D\uDE14&quot;};</b>
<i>56</i>&nbsp;
<i>57</i>&nbsp;    /**
<i>58</i>&nbsp;     * enum of mode of a tweet HAPPY, SAD , NEUTRAL
<i>59</i>&nbsp;     */
<b class="fc"><i>60</i>&nbsp;    public enum Mode {</b>
<b class="fc"><i>61</i>&nbsp;        HAPPY, SAD, NEUTRAL</b>
<i>62</i>&nbsp;    }
<i>63</i>&nbsp;
<i>64</i>&nbsp;    /**
<i>65</i>&nbsp;     * This method return a word-level statistics for the last 250 tweeets that contains a given SearchQuery, counting words in descending order
<i>66</i>&nbsp;     * by frequency of the words.
<i>67</i>&nbsp;     * @author: Girish
<i>68</i>&nbsp;     * @param SearchQuery
<i>69</i>&nbsp;     * @return list of string containing words and its count
<i>70</i>&nbsp;     * @throws TwitterException
<i>71</i>&nbsp;     */
<i>72</i>&nbsp;    public CompletableFuture&lt;List&lt;String&gt;&gt; GetKeywordStats(String SearchQuery) {
<i>73</i>&nbsp;
<b class="fc"><i>74</i>&nbsp;        if ( GlobalWordStatsCache.containsKey(SearchQuery)) {</b>
<b class="fc"><i>75</i>&nbsp;            return CompletableFuture.completedFuture(GlobalWordStatsCache.get(SearchQuery));</b>
<i>76</i>&nbsp;        }
<i>77</i>&nbsp;        else {
<b class="fc"><i>78</i>&nbsp;            Query query = new Query(SearchQuery + &quot; -filter:retweets&quot;);</b>
<b class="fc"><i>79</i>&nbsp;            query.count(250);</b>
<b class="fc"><i>80</i>&nbsp;            query.lang(&quot;en&quot;);</b>
<b class="fc"><i>81</i>&nbsp;            List&lt;String&gt; removewords = Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;, &quot;n&quot;, &quot;o&quot;, &quot;p&quot;, &quot;q&quot;, &quot;r&quot;, &quot;s&quot;, &quot;t&quot;, &quot;u&quot;, &quot;v&quot;, &quot;w&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;as&quot;, &quot;able&quot;, &quot;about&quot;, &quot;above&quot;, &quot;according&quot;, &quot;accordingly&quot;, &quot;across&quot;, &quot;actually&quot;, &quot;after&quot;, &quot;afterwards&quot;, &quot;again&quot;, &quot;against&quot;, &quot;aint&quot;, &quot;all&quot;, &quot;allow&quot;, &quot;allows&quot;, &quot;almost&quot;, &quot;alone&quot;, &quot;along&quot;, &quot;already&quot;, &quot;also&quot;, &quot;although&quot;, &quot;always&quot;, &quot;am&quot;, &quot;among&quot;, &quot;amongst&quot;, &quot;an&quot;, &quot;and&quot;, &quot;another&quot;, &quot;any&quot;, &quot;anybody&quot;, &quot;anyhow&quot;, &quot;anyone&quot;, &quot;anything&quot;, &quot;anyway&quot;, &quot;anyways&quot;, &quot;anywhere&quot;, &quot;apart&quot;, &quot;appear&quot;, &quot;appreciate&quot;, &quot;appropriate&quot;, &quot;are&quot;, &quot;arent&quot;, &quot;around&quot;, &quot;as&quot;, &quot;aside&quot;, &quot;ask&quot;, &quot;asking&quot;, &quot;associated&quot;, &quot;at&quot;, &quot;available&quot;, &quot;away&quot;, &quot;awfully&quot;, &quot;be&quot;, &quot;became&quot;, &quot;because&quot;, &quot;become&quot;, &quot;becomes&quot;, &quot;becoming&quot;, &quot;been&quot;, &quot;before&quot;, &quot;beforehand&quot;, &quot;behind&quot;, &quot;being&quot;, &quot;believe&quot;, &quot;below&quot;, &quot;beside&quot;, &quot;besides&quot;, &quot;best&quot;, &quot;better&quot;, &quot;between&quot;, &quot;beyond&quot;, &quot;both&quot;, &quot;brief&quot;, &quot;but&quot;, &quot;by&quot;, &quot;cmon&quot;, &quot;cs&quot;, &quot;came&quot;, &quot;can&quot;, &quot;cant&quot;, &quot;cannot&quot;, &quot;cant&quot;, &quot;cause&quot;, &quot;causes&quot;, &quot;certain&quot;, &quot;certainly&quot;, &quot;changes&quot;, &quot;clearly&quot;, &quot;co&quot;, &quot;com&quot;, &quot;come&quot;, &quot;comes&quot;, &quot;concerning&quot;, &quot;consequently&quot;, &quot;consider&quot;, &quot;considering&quot;, &quot;contain&quot;, &quot;containing&quot;, &quot;contains&quot;, &quot;corresponding&quot;, &quot;could&quot;, &quot;couldnt&quot;, &quot;course&quot;, &quot;currently&quot;, &quot;definitely&quot;, &quot;described&quot;, &quot;despite&quot;, &quot;did&quot;, &quot;didnt&quot;, &quot;different&quot;, &quot;do&quot;, &quot;does&quot;, &quot;doesnt&quot;, &quot;doing&quot;, &quot;dont&quot;, &quot;done&quot;, &quot;down&quot;, &quot;downwards&quot;, &quot;during&quot;, &quot;each&quot;, &quot;edu&quot;, &quot;eg&quot;, &quot;eight&quot;, &quot;either&quot;, &quot;else&quot;, &quot;elsewhere&quot;, &quot;enough&quot;, &quot;entirely&quot;, &quot;especially&quot;, &quot;et&quot;, &quot;etc&quot;, &quot;even&quot;, &quot;ever&quot;, &quot;every&quot;, &quot;everybody&quot;, &quot;everyone&quot;, &quot;everything&quot;, &quot;everywhere&quot;, &quot;ex&quot;, &quot;exactly&quot;, &quot;example&quot;, &quot;except&quot;, &quot;far&quot;, &quot;few&quot;, &quot;ff&quot;, &quot;fifth&quot;, &quot;first&quot;, &quot;five&quot;, &quot;followed&quot;, &quot;following&quot;, &quot;follows&quot;, &quot;for&quot;, &quot;former&quot;, &quot;formerly&quot;, &quot;forth&quot;, &quot;four&quot;, &quot;from&quot;, &quot;further&quot;, &quot;furthermore&quot;, &quot;get&quot;, &quot;gets&quot;, &quot;getting&quot;, &quot;given&quot;, &quot;gives&quot;, &quot;go&quot;, &quot;goes&quot;, &quot;going&quot;, &quot;gone&quot;, &quot;got&quot;, &quot;gotten&quot;, &quot;greetings&quot;, &quot;had&quot;, &quot;hadnt&quot;, &quot;happens&quot;, &quot;hardly&quot;, &quot;has&quot;, &quot;hasnt&quot;, &quot;have&quot;, &quot;havent&quot;, &quot;having&quot;, &quot;he&quot;, &quot;hes&quot;, &quot;hello&quot;, &quot;help&quot;, &quot;hence&quot;, &quot;her&quot;, &quot;here&quot;, &quot;heres&quot;, &quot;hereafter&quot;, &quot;hereby&quot;, &quot;herein&quot;, &quot;hereupon&quot;, &quot;hers&quot;, &quot;herself&quot;, &quot;hi&quot;, &quot;him&quot;, &quot;himself&quot;, &quot;his&quot;, &quot;hither&quot;, &quot;hopefully&quot;, &quot;how&quot;, &quot;howbeit&quot;, &quot;however&quot;, &quot;i&quot;, &quot;id&quot;, &quot;ill&quot;, &quot;im&quot;, &quot;ive&quot;, &quot;ie&quot;, &quot;if&quot;, &quot;ignored&quot;, &quot;immediate&quot;, &quot;in&quot;, &quot;inasmuch&quot;, &quot;inc&quot;, &quot;indeed&quot;, &quot;indicate&quot;, &quot;indicated&quot;, &quot;indicates&quot;, &quot;inner&quot;, &quot;insofar&quot;, &quot;instead&quot;, &quot;into&quot;, &quot;inward&quot;, &quot;is&quot;, &quot;isnt&quot;, &quot;it&quot;, &quot;itd&quot;, &quot;itll&quot;, &quot;its&quot;, &quot;its&quot;, &quot;itself&quot;, &quot;just&quot;, &quot;keep&quot;, &quot;keeps&quot;, &quot;kept&quot;, &quot;know&quot;, &quot;knows&quot;, &quot;known&quot;, &quot;last&quot;, &quot;lately&quot;, &quot;later&quot;, &quot;latter&quot;, &quot;latterly&quot;, &quot;least&quot;, &quot;less&quot;, &quot;lest&quot;, &quot;let&quot;, &quot;lets&quot;, &quot;like&quot;, &quot;liked&quot;, &quot;likely&quot;, &quot;little&quot;, &quot;look&quot;, &quot;looking&quot;, &quot;looks&quot;, &quot;ltd&quot;, &quot;mainly&quot;, &quot;many&quot;, &quot;may&quot;, &quot;maybe&quot;, &quot;me&quot;, &quot;mean&quot;, &quot;meanwhile&quot;, &quot;merely&quot;, &quot;might&quot;, &quot;more&quot;, &quot;moreover&quot;, &quot;most&quot;, &quot;mostly&quot;, &quot;much&quot;, &quot;must&quot;, &quot;my&quot;, &quot;myself&quot;, &quot;name&quot;, &quot;namely&quot;, &quot;nd&quot;, &quot;near&quot;, &quot;nearly&quot;, &quot;necessary&quot;, &quot;need&quot;, &quot;needs&quot;, &quot;neither&quot;, &quot;never&quot;, &quot;nevertheless&quot;, &quot;new&quot;, &quot;next&quot;, &quot;nine&quot;, &quot;no&quot;, &quot;nobody&quot;, &quot;non&quot;, &quot;none&quot;, &quot;noone&quot;, &quot;nor&quot;, &quot;normally&quot;, &quot;not&quot;, &quot;nothing&quot;, &quot;novel&quot;, &quot;now&quot;, &quot;nowhere&quot;, &quot;obviously&quot;, &quot;of&quot;, &quot;off&quot;, &quot;often&quot;, &quot;oh&quot;, &quot;ok&quot;, &quot;okay&quot;, &quot;old&quot;, &quot;on&quot;, &quot;once&quot;, &quot;one&quot;, &quot;ones&quot;, &quot;only&quot;, &quot;onto&quot;, &quot;or&quot;, &quot;other&quot;, &quot;others&quot;, &quot;otherwise&quot;, &quot;ought&quot;, &quot;our&quot;, &quot;ours&quot;, &quot;ourselves&quot;, &quot;out&quot;, &quot;outside&quot;, &quot;over&quot;, &quot;overall&quot;, &quot;own&quot;, &quot;particular&quot;, &quot;particularly&quot;, &quot;per&quot;, &quot;perhaps&quot;, &quot;placed&quot;, &quot;please&quot;, &quot;plus&quot;, &quot;possible&quot;, &quot;presumably&quot;, &quot;probably&quot;, &quot;provides&quot;, &quot;que&quot;, &quot;quite&quot;, &quot;qv&quot;, &quot;rather&quot;, &quot;rd&quot;, &quot;re&quot;, &quot;really&quot;, &quot;reasonably&quot;, &quot;regarding&quot;, &quot;regardless&quot;, &quot;regards&quot;, &quot;relatively&quot;, &quot;respectively&quot;, &quot;right&quot;, &quot;said&quot;, &quot;same&quot;, &quot;saw&quot;, &quot;say&quot;, &quot;saying&quot;, &quot;says&quot;, &quot;second&quot;, &quot;secondly&quot;, &quot;see&quot;, &quot;seeing&quot;, &quot;seem&quot;, &quot;seemed&quot;, &quot;seeming&quot;, &quot;seems&quot;, &quot;seen&quot;, &quot;self&quot;, &quot;selves&quot;, &quot;sensible&quot;, &quot;sent&quot;, &quot;serious&quot;, &quot;seriously&quot;, &quot;seven&quot;, &quot;several&quot;, &quot;shall&quot;, &quot;she&quot;, &quot;should&quot;, &quot;shouldnt&quot;, &quot;since&quot;, &quot;six&quot;, &quot;so&quot;, &quot;some&quot;, &quot;somebody&quot;, &quot;somehow&quot;, &quot;someone&quot;, &quot;something&quot;, &quot;sometime&quot;, &quot;sometimes&quot;, &quot;somewhat&quot;, &quot;somewhere&quot;, &quot;soon&quot;, &quot;sorry&quot;, &quot;specified&quot;, &quot;specify&quot;, &quot;specifying&quot;, &quot;still&quot;, &quot;sub&quot;, &quot;such&quot;, &quot;sup&quot;, &quot;sure&quot;, &quot;ts&quot;, &quot;take&quot;, &quot;taken&quot;, &quot;tell&quot;, &quot;tends&quot;, &quot;th&quot;, &quot;than&quot;, &quot;thank&quot;, &quot;thanks&quot;, &quot;thanx&quot;, &quot;that&quot;, &quot;thats&quot;, &quot;thats&quot;, &quot;the&quot;, &quot;their&quot;, &quot;theirs&quot;, &quot;them&quot;, &quot;themselves&quot;, &quot;then&quot;, &quot;thence&quot;, &quot;there&quot;, &quot;theres&quot;, &quot;thereafter&quot;, &quot;thereby&quot;, &quot;therefore&quot;, &quot;therein&quot;, &quot;theres&quot;, &quot;thereupon&quot;, &quot;these&quot;, &quot;they&quot;, &quot;theyd&quot;, &quot;theyll&quot;, &quot;theyre&quot;, &quot;theyve&quot;, &quot;think&quot;, &quot;third&quot;, &quot;this&quot;, &quot;thorough&quot;, &quot;thoroughly&quot;, &quot;those&quot;, &quot;though&quot;, &quot;three&quot;, &quot;through&quot;, &quot;throughout&quot;, &quot;thru&quot;, &quot;thus&quot;, &quot;to&quot;, &quot;together&quot;, &quot;too&quot;, &quot;took&quot;, &quot;toward&quot;, &quot;towards&quot;, &quot;tried&quot;, &quot;tries&quot;, &quot;truly&quot;, &quot;try&quot;, &quot;trying&quot;, &quot;twice&quot;, &quot;two&quot;, &quot;un&quot;, &quot;under&quot;, &quot;unfortunately&quot;, &quot;unless&quot;, &quot;unlikely&quot;, &quot;until&quot;, &quot;unto&quot;, &quot;up&quot;, &quot;upon&quot;, &quot;us&quot;, &quot;use&quot;, &quot;used&quot;, &quot;useful&quot;, &quot;uses&quot;, &quot;using&quot;, &quot;usually&quot;, &quot;value&quot;, &quot;various&quot;, &quot;very&quot;, &quot;via&quot;, &quot;viz&quot;, &quot;vs&quot;, &quot;want&quot;, &quot;wants&quot;, &quot;was&quot;, &quot;wasnt&quot;, &quot;way&quot;, &quot;we&quot;, &quot;wed&quot;, &quot;well&quot;, &quot;were&quot;, &quot;weve&quot;, &quot;welcome&quot;, &quot;well&quot;, &quot;went&quot;, &quot;were&quot;, &quot;werent&quot;, &quot;what&quot;, &quot;whats&quot;, &quot;whatever&quot;, &quot;when&quot;, &quot;whence&quot;, &quot;whenever&quot;, &quot;where&quot;, &quot;wheres&quot;, &quot;whereafter&quot;, &quot;whereas&quot;, &quot;whereby&quot;, &quot;wherein&quot;, &quot;whereupon&quot;, &quot;wherever&quot;, &quot;whether&quot;, &quot;which&quot;, &quot;while&quot;, &quot;whither&quot;, &quot;who&quot;, &quot;whos&quot;, &quot;whoever&quot;, &quot;whole&quot;, &quot;whom&quot;, &quot;whose&quot;, &quot;why&quot;, &quot;will&quot;, &quot;willing&quot;, &quot;wish&quot;, &quot;with&quot;, &quot;within&quot;, &quot;without&quot;, &quot;wont&quot;, &quot;wonder&quot;, &quot;would&quot;, &quot;would&quot;, &quot;wouldnt&quot;, &quot;yes&quot;, &quot;yet&quot;, &quot;you&quot;, &quot;youd&quot;, &quot;youll&quot;, &quot;youre&quot;, &quot;youve&quot;, &quot;your&quot;, &quot;yours&quot;, &quot;yourself&quot;, &quot;yourselves&quot;, &quot;zero&quot;);</b>
<i>82</i>&nbsp;            try {
<b class="fc"><i>83</i>&nbsp;                CompletableFuture&lt;List&lt;String&gt;&gt; wordstat_sorted =</b>
<b class="fc"><i>84</i>&nbsp;                        invokeTwitterServer(query)</b>
<b class="fc"><i>85</i>&nbsp;                                .thenApply(result -&gt; result.getTweets()</b>
<b class="fc"><i>86</i>&nbsp;                                        .parallelStream()</b>
<b class="fc"><i>87</i>&nbsp;                                        .map(s -&gt; s.getText().split(&quot; &quot;))</b>
<b class="fc"><i>88</i>&nbsp;                                        .flatMap(Arrays::stream)</b>
<b class="fc"><i>89</i>&nbsp;                                        .filter(t -&gt; t.matches(&quot;[a-zA-Z]+&quot;))</b>
<b class="fc"><i>90</i>&nbsp;                                        .filter(t -&gt; !removewords.contains(t))</b>
<b class="fc"><i>91</i>&nbsp;                                        .collect(Collectors.toMap(s -&gt; s, s -&gt; 1, Integer::sum))</b>
<i>92</i>&nbsp;                                )
<b class="fc"><i>93</i>&nbsp;                                .thenApply(wordstat_unsorted -&gt; wordstat_unsorted.entrySet()</b>
<b class="fc"><i>94</i>&nbsp;                                        .parallelStream()</b>
<b class="fc"><i>95</i>&nbsp;                                        .sorted(Map.Entry.&lt;String, Integer&gt;comparingByValue().reversed())</b>
<b class="fc"><i>96</i>&nbsp;                                        .map(swc -&gt; {</b>
<b class="fc"><i>97</i>&nbsp;                                            return swc.getKey() + &quot;:&quot; + swc.getValue() + &quot;\n&quot;;</b>
<i>98</i>&nbsp;                                        })
<b class="fc"><i>99</i>&nbsp;                                        .collect(Collectors.toList())</b>
<i>100</i>&nbsp;                                )
<b class="fc"><i>101</i>&nbsp;                                .thenApply(word_sorted -&gt; {</b>
<b class="fc"><i>102</i>&nbsp;                                            GlobalWordStatsCache.put((SearchQuery), word_sorted);</b>
<b class="fc"><i>103</i>&nbsp;                                            return word_sorted;</b>
<i>104</i>&nbsp;                                        }
<i>105</i>&nbsp;                                );
<b class="fc"><i>106</i>&nbsp;                return wordstat_sorted;</b>
<i>107</i>&nbsp;            }
<i>108</i>&nbsp;
<b class="nc"><i>109</i>&nbsp;            catch (NullPointerException ex){</b>
<b class="nc"><i>110</i>&nbsp;                return CompletableFuture.completedFuture(Arrays.asList(&quot;Returned result is null&quot; + ex.getMessage()));</b>
<i>111</i>&nbsp;
<i>112</i>&nbsp;            }
<i>113</i>&nbsp;        }
<i>114</i>&nbsp;    }
<i>115</i>&nbsp;
<i>116</i>&nbsp;
<i>117</i>&nbsp;    /**
<i>118</i>&nbsp;     * Lambda BiFunction that takes a search query and its result, then return a formatted HTML string.
<i>119</i>&nbsp;     */
<b class="fc"><i>120</i>&nbsp;    private static final BiFunction&lt;String, String, String&gt; tweetDisplayPageFormat = (searchquery, result) -&gt; &quot;		&lt;tr&gt;\n&quot; +</b>
<i>121</i>&nbsp;            &quot;			&lt;th&gt;Search terms:&lt;/th&gt;\n&quot; +
<b class="fc"><i>122</i>&nbsp;            &quot;			&lt;th&gt;&lt;a href=/keyword?s=&quot; + searchquery.replaceAll(&quot; &quot;, &quot;+&quot;) + &quot;&gt;&quot; + searchquery  + &quot;&lt;/a&gt;&lt;/th&gt;\n&quot; +</b>
<b class="fc"><i>123</i>&nbsp;            &quot;	&lt;th&gt;&quot;+ getTweetSentiments(searchquery) +&quot;&lt;/th&gt;&quot; +</b>
<i>124</i>&nbsp;            &quot;		&lt;/tr&gt;\n&quot; +
<i>125</i>&nbsp;            &quot;		&lt;tr&gt;\n&quot; +
<i>126</i>&nbsp;            &quot;			&lt;th&gt;User&lt;/th&gt;\n&quot; +
<i>127</i>&nbsp;            &quot;			&lt;th&gt;Location&lt;/th&gt;\n&quot; +
<i>128</i>&nbsp;            &quot;			&lt;th&gt;Tweet Text&lt;/th&gt;\n&quot; +
<i>129</i>&nbsp;            &quot;		&lt;/tr&gt;\n&quot; + result;
<i>130</i>&nbsp;
<i>131</i>&nbsp;
<i>132</i>&nbsp;    /**
<i>133</i>&nbsp;     * Returns sessionData contains searchQuery with given userID
<i>134</i>&nbsp;     * If GlobalCache contains a given keyword, then add it into LocalCache.
<i>135</i>&nbsp;     * If the words have not been looked up before, call the overloaded method of GetTweets_keyword(String)
<i>136</i>&nbsp;     * to look up the tweets, then add the result into GlobalCache and LocalCache of currentUser.
<i>137</i>&nbsp;     * If the given keyword length is less than 1, return the currentUser session data.
<i>138</i>&nbsp;     *
<i>139</i>&nbsp;     * @param searchQuery : keyword that user want to looks up tweets
<i>140</i>&nbsp;     * @param UserID      : user that request the search
<i>141</i>&nbsp;     * @return sessionData of current user with given params
<i>142</i>&nbsp;     * @throws TwitterException
<i>143</i>&nbsp;     * @see models.GetTweets#GetTweetsWithKeyword(String)
<i>144</i>&nbsp;     */
<i>145</i>&nbsp;    public CompletionStage&lt;sessionData&gt; GetTweetsWithUser(String searchQuery, String UserID)  {
<i>146</i>&nbsp;
<b class="fc"><i>147</i>&nbsp;       sessionData currentUser = sessionData.getUser(UserID);</b>
<i>148</i>&nbsp;       
<b class="fc"><i>149</i>&nbsp;        if (searchQuery.length() &lt; 2) {</b>
<b class="fc"><i>150</i>&nbsp;            return CompletableFuture.completedFuture(currentUser);</b>
<i>151</i>&nbsp;        }
<i>152</i>&nbsp;
<b class="fc"><i>153</i>&nbsp;        if (GlobalCache.containsKey(searchQuery)) {</b>
<b class="fc"><i>154</i>&nbsp;            List&lt;String&gt; userQuery = currentUser.getQuery();</b>
<b class="fc"><i>155</i>&nbsp;            if (userQuery.contains(searchQuery)) {</b>
<b class="fc"><i>156</i>&nbsp;                userQuery.remove(searchQuery);</b>
<b class="fc"><i>157</i>&nbsp;                userQuery.add(0, searchQuery);</b>
<i>158</i>&nbsp;            } else {
<b class="fc"><i>159</i>&nbsp;                currentUser.insertCache(searchQuery, GlobalCache.get(searchQuery));</b>
<i>160</i>&nbsp;            }
<b class="fc"><i>161</i>&nbsp;            return CompletableFuture.completedFuture(currentUser);</b>
<i>162</i>&nbsp;        } else {
<b class="fc"><i>163</i>&nbsp;            return GetTweetsWithKeyword(searchQuery).thenApply(result -&gt; {</b>
<i>164</i>&nbsp;                
<b class="fc"><i>165</i>&nbsp;                GlobalCache.put(searchQuery, result);</b>
<b class="fc"><i>166</i>&nbsp;                currentUser.insertCache(searchQuery, result);</b>
<b class="fc"><i>167</i>&nbsp;                return currentUser;</b>
<i>168</i>&nbsp;            });
<i>169</i>&nbsp;        }
<i>170</i>&nbsp;
<i>171</i>&nbsp;    }
<i>172</i>&nbsp;
<i>173</i>&nbsp;
<i>174</i>&nbsp;    /**
<i>175</i>&nbsp;     * Takes a string keyword and return a HTML formatted string showing the last 10 tweets contains the given keyword.
<i>176</i>&nbsp;     * Only returns tweets with language of english.
<i>177</i>&nbsp;     *
<i>178</i>&nbsp;     * @param keyword : The keyword to looks up tweets
<i>179</i>&nbsp;     * @return : HTML formatter string
<i>180</i>&nbsp;     */
<i>181</i>&nbsp;    public  CompletionStage&lt;String&gt; GetTweetsWithKeyword(String keyword)  {
<b class="fc"><i>182</i>&nbsp;        if (keyword.length() &lt; 2) {</b>
<b class="fc"><i>183</i>&nbsp;            return CompletableFuture.completedFuture(&quot;Cannot process empty string/Single Letter&quot;);</b>
<i>184</i>&nbsp;        }
<i>185</i>&nbsp;
<b class="fc"><i>186</i>&nbsp;        if (GlobalCache.containsKey(keyword)) {</b>
<i>187</i>&nbsp;
<b class="fc"><i>188</i>&nbsp;            return CompletableFuture.completedFuture(</b>
<b class="fc"><i>189</i>&nbsp;                    GlobalCache.get(keyword)</b>
<i>190</i>&nbsp;            );
<i>191</i>&nbsp;        }
<i>192</i>&nbsp;
<b class="fc"><i>193</i>&nbsp;        Query query = new Query(keyword + &quot; -filter:retweets&quot;);</b>
<b class="fc"><i>194</i>&nbsp;        query.count(250);</b>
<b class="fc"><i>195</i>&nbsp;        query.lang(&quot;en&quot;);</b>
<b class="fc"><i>196</i>&nbsp;            return invokeTwitterServer(query)</b>
<b class="fc"><i>197</i>&nbsp;                    .thenApply(result -&gt; formatSentimental.apply(result, keyword))</b>
<b class="fc"><i>198</i>&nbsp;                    .thenApply(result -&gt; formatResult.apply(result))</b>
<b class="fc"><i>199</i>&nbsp;                    .thenApply(tweet -&gt; {</b>
<b class="fc"><i>200</i>&nbsp;                        GlobalCache.put(keyword, tweetDisplayPageFormat.apply(keyword, tweet));</b>
<b class="fc"><i>201</i>&nbsp;                        return GlobalCache.get(keyword);</b>
<b class="fc"><i>202</i>&nbsp;                    }).exceptionally( ex -&gt; ex.getMessage());</b>
<i>203</i>&nbsp;
<i>204</i>&nbsp;
<i>205</i>&nbsp;    }
<i>206</i>&nbsp;
<i>207</i>&nbsp;    /**
<i>208</i>&nbsp;     * Returns a boolean after matching a tweet text with provided list of happy/sad strings
<i>209</i>&nbsp;     * @param inputStr ,items
<i>210</i>&nbsp;     * @return boolean
<i>211</i>&nbsp;     */
<i>212</i>&nbsp;
<i>213</i>&nbsp;    public static boolean stringContainsItemFromList(String inputStr, String[] items) {
<b class="fc"><i>214</i>&nbsp;        return Arrays.stream(items).anyMatch(inputStr.toUpperCase() ::contains);</b>
<i>215</i>&nbsp;    }
<i>216</i>&nbsp;    /**
<i>217</i>&nbsp;     * Returns and stores mode analysis of tweets from a global cache
<i>218</i>&nbsp;     * @author: Suhel
<i>219</i>&nbsp;     * @param searchQuery
<i>220</i>&nbsp;     * @return String
<i>221</i>&nbsp;     */
<i>222</i>&nbsp;
<i>223</i>&nbsp;    public static String getTweetSentiments(String searchQuery){
<i>224</i>&nbsp;
<i>225</i>&nbsp;
<b class="fc"><i>226</i>&nbsp;        if ( GlobalSentiments.containsKey(searchQuery)) {</b>
<b class="fc"><i>227</i>&nbsp;            return GlobalSentiments.get(searchQuery);</b>
<i>228</i>&nbsp;        }
<b class="fc"><i>229</i>&nbsp;        return &quot;Could not analyse Sentiments Due to Error/less no of Tweets on this Topic&quot;;</b>
<i>230</i>&nbsp;
<i>231</i>&nbsp;    }
<i>232</i>&nbsp;
<i>233</i>&nbsp;    /**
<i>234</i>&nbsp;     * Rendered the HTML for mode analysis and adds emoticons
<i>235</i>&nbsp;     * @author: Suhel
<i>236</i>&nbsp;     * @param mood,percentage
<i>237</i>&nbsp;     * @return String
<i>238</i>&nbsp;     */
<i>239</i>&nbsp;    public static String renderSentimentsHTML(String mood,double percentage){
<b class="fc"><i>240</i>&nbsp;        String emoticon=&quot;&quot;;</b>
<b class="fc"><i>241</i>&nbsp;        if (mood.equals(Mode.HAPPY.toString())) emoticon=&quot;\uD83D\uDE0C&quot;;</b>
<b class="fc"><i>242</i>&nbsp;        else if (mood.equals(Mode.SAD.toString())) emoticon=&quot;\uD83D\uDE1E&quot;;</b>
<b class="fc"><i>243</i>&nbsp;        else emoticon=&quot;\uD83D\uDE11&quot;;</b>
<b class="fc"><i>244</i>&nbsp;        emoticon= &quot;\uD83D\uDCCA&quot;  +emoticon+&quot; &quot;+&quot; Tweets are &quot; +mood ;</b>
<b class="fc"><i>245</i>&nbsp;        return emoticon;</b>
<i>246</i>&nbsp;
<i>247</i>&nbsp;    }
<i>248</i>&nbsp;
<i>249</i>&nbsp;
<i>250</i>&nbsp;    /**
<i>251</i>&nbsp;     * Get 10 tweets from Query result and adding HTML tags to display on screen.
<i>252</i>&nbsp;     */
<b class="fc"><i>253</i>&nbsp;    private  Function&lt;QueryResult,String&gt; formatResult = (result) -&gt; {</b>
<i>254</i>&nbsp;
<b class="fc"><i>255</i>&nbsp;        return result.getTweets().parallelStream()</b>
<b class="fc"><i>256</i>&nbsp;                .map(s -&gt; {</b>
<b class="fc"><i>257</i>&nbsp;                    return &quot;\n&quot; +</b>
<i>258</i>&nbsp;                            &quot;&lt;tr&gt;\n&quot; +
<b class="fc"><i>259</i>&nbsp;                            &quot;		&lt;td&gt;&lt;a href=/user?s=&quot; + s.getUser().getScreenName().replaceAll(&quot; &quot;, &quot;+&quot;) + &quot;&gt; &quot; + s.getUser().getScreenName() + &quot;&lt;/a&gt;&lt;/td&gt;\n&quot; +</b>
<b class="fc"><i>260</i>&nbsp;                            &quot;		&lt;td&gt;&lt;a href=/location?s=&quot; + s.getUser().getLocation().replaceAll(&quot; &quot;, &quot;+&quot;) + &quot;&gt;&quot; + s.getUser().getLocation() + &quot;&lt;/a&gt;&lt;/td&gt;\n&quot; +</b>
<b class="fc"><i>261</i>&nbsp;                            &quot;		&lt;td&gt;&quot; + s.getText().replaceAll(&quot;#(\\w+)+&quot;, &quot;&lt;a href=/hashtag?s=$1&gt;#$1&lt;/a&gt;&quot;) + &quot;&lt;/td&gt;\n&quot; +</b>
<i>262</i>&nbsp;                            &quot;&lt;/tr&gt;\n&quot;;
<i>263</i>&nbsp;                })
<b class="fc"><i>264</i>&nbsp;                .limit(10)</b>
<b class="fc"><i>265</i>&nbsp;                .reduce(&quot;&quot;,</b>
<i>266</i>&nbsp;                        String::concat);
<i>267</i>&nbsp;
<i>268</i>&nbsp;    };
<i>269</i>&nbsp;
<i>270</i>&nbsp;
<i>271</i>&nbsp;    /**
<i>272</i>&nbsp;     * Calculate the percentage of Happy or Sad tweet and store the result in GlobalSentiments Hashmap.
<i>273</i>&nbsp;     */
<b class="fc"><i>274</i>&nbsp;    private  BiFunction&lt;QueryResult, String, QueryResult&gt; formatSentimental = (result, keyword) -&gt;{</b>
<i>275</i>&nbsp;
<b class="fc"><i>276</i>&nbsp;        String modeString = &quot;&quot;;</b>
<b class="fc"><i>277</i>&nbsp;        int queryResultSize = result.getTweets().size();</b>
<i>278</i>&nbsp;        Map&lt;Mode, List&lt;Status&gt;&gt; analyse;
<i>279</i>&nbsp;
<i>280</i>&nbsp;        //Stream Grouping based on tweet Text
<b class="fc"><i>281</i>&nbsp;        analyse = result.getTweets().parallelStream()</b>
<b class="fc"><i>282</i>&nbsp;                .collect(groupingBy(s -&gt; {</b>
<b class="fc"><i>283</i>&nbsp;                    if (stringContainsItemFromList(s.getText(), happy)) return Mode.HAPPY;</b>
<b class="fc"><i>284</i>&nbsp;                    else if (stringContainsItemFromList(s.getText(), sad)) return Mode.SAD;</b>
<b class="fc"><i>285</i>&nbsp;                    else return Mode.NEUTRAL;</b>
<i>286</i>&nbsp;                }));
<i>287</i>&nbsp;
<b class="fc"><i>288</i>&nbsp;        if (analyse.containsKey(Mode.HAPPY)) {</b>
<b class="fc"><i>289</i>&nbsp;            double indicator = (analyse.get(Mode.HAPPY).size() * 100 / queryResultSize);</b>
<b class="fc"><i>290</i>&nbsp;            if (indicator &gt;= 70) {</b>
<b class="fc"><i>291</i>&nbsp;                modeString=renderSentimentsHTML(Mode.HAPPY.toString(),indicator);</b>
<i>292</i>&nbsp;
<i>293</i>&nbsp;            }
<i>294</i>&nbsp;        }
<b class="fc"><i>295</i>&nbsp;        if (analyse.containsKey(Mode.SAD)) {</b>
<b class="fc"><i>296</i>&nbsp;            double indicator = (analyse.get(Mode.SAD).size() * 100 / queryResultSize);</b>
<b class="fc"><i>297</i>&nbsp;            if (indicator &gt;= 70) {</b>
<b class="fc"><i>298</i>&nbsp;                modeString=renderSentimentsHTML(Mode.SAD.toString(),indicator);</b>
<i>299</i>&nbsp;
<i>300</i>&nbsp;            }
<i>301</i>&nbsp;        }
<b class="fc"><i>302</i>&nbsp;        if (&quot;&quot;.equals(modeString)) {</b>
<b class="fc"><i>303</i>&nbsp;            modeString=renderSentimentsHTML(Mode.NEUTRAL.toString(),0);</b>
<i>304</i>&nbsp;
<i>305</i>&nbsp;        }
<b class="fc"><i>306</i>&nbsp;        GlobalSentiments.put(keyword, modeString); //cache with a key</b>
<b class="fc"><i>307</i>&nbsp;        return result;</b>
<i>308</i>&nbsp;    };
<i>309</i>&nbsp;
<i>310</i>&nbsp;
<i>311</i>&nbsp;    /**
<i>312</i>&nbsp;     * Invoke Live Twitter server
<i>313</i>&nbsp;     * @param query : search query to send to Twitter
<i>314</i>&nbsp;     * @return: Query Result that include Tweets containing search query parameter.
<i>315</i>&nbsp;     */
<i>316</i>&nbsp;    private CompletableFuture&lt;QueryResult&gt; invokeTwitterServer(Query query)   {
<b class="fc"><i>317</i>&nbsp;        return CompletableFuture.supplyAsync( () -&gt; {</b>
<i>318</i>&nbsp;            try {
<b class="fc"><i>319</i>&nbsp;                return twitter.search(query);</b>
<b class="nc"><i>320</i>&nbsp;            } catch (Exception e) {</b>
<b class="nc"><i>321</i>&nbsp;                System.out.println(&quot;Twitter Error: &quot; + e.getMessage());</b>
<b class="nc"><i>322</i>&nbsp;                return null;</b>
<i>323</i>&nbsp;            }
<i>324</i>&nbsp;        });
<i>325</i>&nbsp;
<i>326</i>&nbsp;    }
<i>327</i>&nbsp;
<i>328</i>&nbsp;
<i>329</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2020-11-12 17:08</div>
</div>
</body>
</html>
